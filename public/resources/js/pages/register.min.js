let RegisterForm={elements:{registerContainer:"#register-form",emailInput:"#register-email-input",passwordInput:"#register-password-input",passwordConfirmInput:"#register-password-confirm-input",firstNameInput:"#register-firstname-input",lastNameInput:"#register-lastname-input",phoneInput:"#register-phone-input",addressInput:"#register-address-input",submitButton:"#register-button",errorMessage:"#register-error-message"},handlers:{registerProcess:function(){var e=RegisterForm,s=window.$;let t=s(e.elements.emailInput).val().trim();var n=s(e.elements.passwordInput).val(),i=s(e.elements.passwordConfirmInput).val(),a=s(e.elements.firstNameInput).val().trim(),r=s(e.elements.lastNameInput).val().trim(),o=s(e.elements.phoneInput).val().trim(),d=s(e.elements.addressInput).val().trim();let l=s(e.elements.errorMessage),m=s(e.elements.submitButton);l.text("").removeClass("is-danger is-success"),t&&n&&i&&a&&r?n!==i?l.text("Passwords do not match.").addClass("is-danger"):(m.prop("disabled",!0).addClass("is-loading"),s.ajax({url:"user/register",type:"POST",contentType:"application/json",data:JSON.stringify({username:t,email:t,password:n,type:"user",permissions:16,personal_info:{first_name:a,last_name:r,phone:o,address:d}}),success:function(s){if(l.text("").removeClass("is-danger is-success"),s.message&&-1!==s.message.indexOf("User registered"))l.text("Registration successful! Please check your email for the confirmation code.").addClass("is-success"),RegisterForm.confirmation.showCodeInput(t,!0);else if(s.message)l.text(s.message).addClass("is-danger");else if(s.error)l.text(s.error).addClass("is-danger");else if(s.messages){let e="";e="object"==typeof s.messages?Object.values(s.messages).join(" "):s.messages,l.text(e).addClass("is-danger")}else l.text("Registration failed. Please try again.").addClass("is-danger");m.prop("disabled",!1).removeClass("is-loading")},error:function(e){let s="An error occurred. Please try again.";e.responseJSON&&e.responseJSON.messages?s=e.responseJSON.messages.error:e.responseJSON&&e.responseJSON.error&&(s=e.responseJSON.error),l.text(s).addClass("is-danger"),m.prop("disabled",!1).removeClass("is-loading")}})):l.text("Please fill in all required fields.").addClass("is-danger")}},confirmation:{showCodeInput:function(e,s){var t=RegisterForm;let n=(0,window.$)(t.elements.registerContainer);s?(n.addClass("animate__animated animate__fadeOut animate__delay-2s"),setTimeout(function(){n.hide(),RegisterForm.confirmation.renderCodeInput(e)},400)):(n.hide(),RegisterForm.confirmation.renderCodeInput(e))},renderCodeInput:function(s){var e=window.$;0===e("#confirmation-code-section").length?e(RegisterForm.elements.registerContainer).after(`
                <div id="confirmation-code-section" class="box mt-4 animate__animated animate__fadeIn animate__delay-2s">
                    <label class="label">Enter Confirmation Code</label>
                    <div class="field has-addons">
                        <div class="control">
                            <input id="confirmation-code-input" class="input" type="text" maxlength="6" placeholder="6-digit code">
                        </div>
                        <div class="control">
                            <button id="confirm-code-button" class="button is-link">Confirm</button>
                        </div>
                    </div>
                    <p id="confirmation-code-message" class="help"></p>
                </div>
                `):e("#confirmation-code-section").show().addClass("animate__animated animate__fadeIn animate__delay-2s"),e("#confirm-code-button").off("click").on("click",function(e){e.preventDefault(),RegisterForm.confirmation.submitCode(s)})},submitCode:function(e){let t=window.$;var s=t("#confirmation-code-input").val().trim();let n=t("#confirmation-code-message");n.text("").removeClass("is-danger is-success"),s&&6===s.length?(t("#confirm-code-button").prop("disabled",!0).addClass("is-loading"),t.ajax({url:"user/activate",type:"POST",contentType:"application/json",data:JSON.stringify({email:e,confirmation_code:s}),success:function(e){e.message?(n.text(e.message).addClass("is-success"),t("#confirmation-code-section").removeClass("animate__fadeIn").addClass("animate__fadeOut"),setTimeout(function(){t("#confirmation-code-section").hide(),window.location.href="/login"},1200)):n.text("Activation failed.").addClass("is-danger"),t("#confirm-code-button").prop("disabled",!1).removeClass("is-loading")},error:function(e){let s="Activation failed.";e.responseJSON&&e.responseJSON.messages?s=e.responseJSON.messages.error:e.responseJSON&&e.responseJSON.error&&(s=e.responseJSON.error),n.text(s).addClass("is-danger"),t("#confirm-code-button").prop("disabled",!1).removeClass("is-loading")}})):n.text("Please enter the 6-digit code sent to your email.").addClass("is-danger")}},events:{registerSubmit:function(){let s=RegisterForm;var e=window.$,t=e(s.elements.registerContainer),e=e(s.elements.submitButton);t.on("submit",function(e){e.preventDefault(),s.handlers.registerProcess()}),e.on("click",function(e){e.preventDefault(),s.handlers.registerProcess()})},init:function(){this.registerSubmit()}},init:function(){this.events.init()}};document.addEventListener("DOMContentLoaded",function(){RegisterForm.init()});